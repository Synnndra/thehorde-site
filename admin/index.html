<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin — The Horde</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/orclogo.jpg" type="image/jpeg">
    <link rel="stylesheet" href="/shared/base.css">
    <link rel="stylesheet" href="/admin/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <a href="#dashboard" class="skip-link">Skip to content</a>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h1>The Horde</h1>
            <p class="login-subtitle">Admin Dashboard</p>
            <form id="login-form">
                <input type="password" id="password-input" placeholder="Enter admin secret" autocomplete="off" required>
                <button type="submit">Enter</button>
            </form>
            <p id="login-error" class="error-text" hidden></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" hidden>
        <header>
            <h1>Admin Dashboard</h1>
            <div class="header-actions">
                <button id="refresh-btn" title="Refresh">&#x21bb; Refresh</button>
                <button id="logout-btn">Logout</button>
            </div>
        </header>

        <!-- Tweet Queue -->
        <section class="card" id="tweets-section">
            <h2>Tweet Queue</h2>

            <!-- Compose -->
            <div class="tweet-subsection">
                <h3>Compose Tweet</h3>
                <form id="tweet-compose-form" class="tweet-form">
                    <input type="text" id="tweet-topic-input" placeholder="Topic (optional — leave blank for auto)">
                    <button type="submit">Compose</button>
                </form>
                <p id="tweet-compose-status" class="success-text" hidden></p>
                <p id="tweet-compose-error" class="error-text" hidden></p>
            </div>

            <!-- Pending Drafts -->
            <div class="tweet-subsection">
                <h3>Pending Drafts</h3>
                <button id="tweet-refresh-btn" class="btn-small">Refresh</button>
                <div id="tweet-drafts-list"></div>
                <p id="tweet-drafts-empty" class="empty-text" hidden>No drafts.</p>
            </div>

            <!-- Posted History -->
            <div class="tweet-subsection">
                <h3>Posted History</h3>
                <button id="tweet-history-btn" class="btn-small">Refresh</button>
                <div id="tweet-history-list"></div>
            </div>
        </section>

        <!-- Knowledge Base -->
        <section class="card" id="knowledge-section">
            <h2>Drak Knowledge Base</h2>

            <!-- Add Fact -->
            <div class="knowledge-subsection">
                <h3>Add Fact</h3>
                <form id="knowledge-add-form" class="knowledge-form">
                    <textarea id="knowledge-text-input" placeholder="Fact text (max 500 chars)" rows="3" maxlength="500" required></textarea>
                    <select id="knowledge-category-input">
                        <option value="general">General</option>
                        <option value="project">Project</option>
                        <option value="community">Community</option>
                        <option value="market">Market</option>
                        <option value="lore">Lore</option>
                    </select>
                    <label class="knowledge-image-label">
                        <span class="btn-small">Attach Image</span>
                        <input type="file" id="knowledge-image-input" accept="image/png,image/jpeg,image/gif,image/webp" hidden>
                    </label>
                    <div id="knowledge-image-preview" class="knowledge-image-preview" hidden>
                        <img id="knowledge-image-thumb">
                        <button type="button" id="knowledge-image-remove" class="btn-small btn-danger">Remove</button>
                    </div>
                    <button type="submit">Add Fact</button>
                </form>
                <p id="knowledge-add-error" class="error-text" hidden></p>
                <p id="knowledge-add-success" class="success-text" hidden></p>
            </div>

            <!-- Existing Facts -->
            <div class="knowledge-subsection">
                <h3>Existing Facts</h3>
                <button id="knowledge-refresh-btn" class="btn-small">Refresh</button>
                <div id="knowledge-list" class="knowledge-list"></div>
                <p id="knowledge-list-empty" class="empty-text" hidden>No facts added yet.</p>
            </div>

            <!-- Monitored X Accounts -->
            <div class="knowledge-subsection">
                <h3>Monitored X Accounts</h3>
                <p class="subsection-hint">Drak researches these accounts before composing tweets. One handle per line (no @).</p>
                <textarea id="research-accounts-input" placeholder="BrokeFury&#10;synndrabtc&#10;sircandyapple" rows="6"></textarea>
                <div class="knowledge-form-actions">
                    <button id="research-accounts-save" class="btn-small">Save Accounts</button>
                </div>
                <p id="research-accounts-error" class="error-text" hidden></p>
                <p id="research-accounts-success" class="success-text" hidden></p>
            </div>
        </section>

        <!-- Health Stoplight -->
        <section class="card" id="health-section">
            <h2>System Health</h2>
            <div class="stoplight-row">
                <div class="stoplight-item">
                    <span class="indicator" id="health-kv"></span>
                    <span class="indicator-label">KV Store</span>
                </div>
                <div class="stoplight-item">
                    <span class="indicator" id="health-helius"></span>
                    <span class="indicator-label">Helius RPC</span>
                </div>
                <div class="stoplight-item">
                    <span class="indicator" id="health-escrow"></span>
                    <span class="indicator-label">Escrow Balance: <span id="escrow-balance">—</span></span>
                </div>
            </div>
        </section>

        <!-- Stats Bar -->
        <section class="card" id="stats-section">
            <h2>Stats</h2>
            <div class="stats-row" id="stats-row">
                <div class="stat"><span class="stat-value" id="stat-total">—</span><span class="stat-label">Total</span></div>
                <div class="stat"><span class="stat-value" id="stat-pending">—</span><span class="stat-label">Pending</span></div>
                <div class="stat"><span class="stat-value" id="stat-escrowed">—</span><span class="stat-label">Escrowed</span></div>
                <div class="stat"><span class="stat-value" id="stat-completed">—</span><span class="stat-label">Completed</span></div>
                <div class="stat"><span class="stat-value" id="stat-failed">—</span><span class="stat-label">Failed</span></div>
                <div class="stat"><span class="stat-value" id="stat-cancelled">—</span><span class="stat-label">Cancelled</span></div>
                <div class="stat"><span class="stat-value" id="stat-expired">—</span><span class="stat-label">Expired</span></div>
                <div class="stat"><span class="stat-value" id="stat-24h">—</span><span class="stat-label">Last 24h</span></div>
            </div>
        </section>

        <!-- Search -->
        <section class="card" id="search-section">
            <h2>Search Offer</h2>
            <form id="search-form">
                <input type="text" id="search-input" placeholder="offer_xxxxxxxx">
                <button type="submit">Search</button>
            </form>
            <p id="search-error" class="error-text" hidden></p>
        </section>

        <!-- Badge Management -->
        <section class="card" id="badges-section">
            <h2>Badge Management</h2>

            <!-- Create Badge -->
            <div class="badge-subsection">
                <h3>Create Badge</h3>
                <form id="badge-create-form" class="badge-form">
                    <input type="text" id="badge-id-input" placeholder="badge_id (lowercase, underscores)" required pattern="^[a-z0-9_]+$">
                    <input type="text" id="badge-name-input" placeholder="Display Name" required maxlength="64">
                    <input type="text" id="badge-desc-input" placeholder="Description (optional)" maxlength="256">
                    <input type="text" id="badge-icon-input" placeholder="Icon emoji (default: ⭐)" maxlength="8">
                    <input type="text" id="badge-image-input" placeholder="Image URL (optional)">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <label for="badge-image-file" style="cursor:pointer;padding:6px 14px;background:#5a3e1b;border:1px solid #8b6914;border-radius:4px;color:#c4a54d;font-family:'Cinzel',serif;font-size:0.85rem;">Upload Image</label>
                        <input type="file" id="badge-image-file" accept="image/*" style="display:none;">
                        <span id="badge-file-name" style="color:#999;font-size:0.8rem;"></span>
                    </div>
                    <button type="submit">Create Badge</button>
                </form>
                <p id="badge-create-error" class="error-text" hidden></p>
                <p id="badge-create-success" class="success-text" hidden></p>
            </div>

            <!-- Award Badge -->
            <div class="badge-subsection">
                <h3>Award Badge</h3>
                <form id="badge-award-form" class="badge-form">
                    <select id="badge-award-select">
                        <option value="">Select a badge...</option>
                    </select>
                    <textarea id="badge-wallets-input" placeholder="Wallet addresses (one per line)" rows="4"></textarea>
                    <div class="badge-form-actions">
                        <button type="submit">Award</button>
                        <button type="button" id="badge-revoke-btn" class="btn-danger">Revoke</button>
                    </div>
                </form>
                <p id="badge-award-error" class="error-text" hidden></p>
                <p id="badge-award-success" class="success-text" hidden></p>
            </div>

            <!-- Badge List -->
            <div class="badge-subsection">
                <h3>Existing Badges</h3>
                <button id="badge-refresh-btn" class="btn-small">Refresh</button>
                <div id="badge-list" class="badge-list"></div>
                <p id="badge-list-empty" class="empty-text" hidden>No badges created yet.</p>
            </div>

            <!-- Backfill -->
            <div class="badge-subsection">
                <button id="badge-backfill-btn" class="btn-small">Backfill Swap Counts</button>
                <p id="badge-backfill-result" class="success-text" hidden></p>
            </div>
        </section>

        <!-- Offer Table -->
        <section class="card" id="offers-section">
            <h2>Recent Offers</h2>
            <div class="table-wrap">
                <table id="offers-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Offer ID</th>
                            <th>Status</th>
                            <th>Initiator</th>
                            <th>Receiver</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="offers-body"></tbody>
                </table>
            </div>
            <p id="offers-empty" class="empty-text" hidden>No offers found.</p>
        </section>
    </div>

    <script src="/admin/app.js"></script>
</body>
</html>
