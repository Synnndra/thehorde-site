<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin — The Horde</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="/orclogo.jpg" type="image/jpeg">
    <link rel="stylesheet" href="/admin/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <a href="#dashboard" class="skip-link">Skip to content</a>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h1>The Horde</h1>
            <p class="login-subtitle">Admin Dashboard</p>
            <form id="login-form">
                <input type="password" id="password-input" placeholder="Enter admin secret" autocomplete="off" required>
                <button type="submit">Enter</button>
            </form>
            <p id="login-error" class="error-text" hidden></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" hidden>
        <header>
            <h1>Admin Dashboard</h1>
            <div class="header-actions">
                <button id="refresh-btn" title="Refresh">&#x21bb; Refresh</button>
                <button id="logout-btn">Logout</button>
            </div>
        </header>

        <!-- Health Stoplight -->
        <section class="card" id="health-section">
            <h2>System Health</h2>
            <div class="stoplight-row">
                <div class="stoplight-item">
                    <span class="indicator" id="health-kv"></span>
                    <span class="indicator-label">KV Store</span>
                </div>
                <div class="stoplight-item">
                    <span class="indicator" id="health-helius"></span>
                    <span class="indicator-label">Helius RPC</span>
                </div>
                <div class="stoplight-item">
                    <span class="indicator" id="health-escrow"></span>
                    <span class="indicator-label">Escrow Balance: <span id="escrow-balance">—</span></span>
                </div>
            </div>
        </section>

        <!-- Stats Bar -->
        <section class="card" id="stats-section">
            <h2>Stats</h2>
            <div class="stats-row" id="stats-row">
                <div class="stat"><span class="stat-value" id="stat-total">—</span><span class="stat-label">Total</span></div>
                <div class="stat"><span class="stat-value" id="stat-pending">—</span><span class="stat-label">Pending</span></div>
                <div class="stat"><span class="stat-value" id="stat-escrowed">—</span><span class="stat-label">Escrowed</span></div>
                <div class="stat"><span class="stat-value" id="stat-completed">—</span><span class="stat-label">Completed</span></div>
                <div class="stat"><span class="stat-value" id="stat-failed">—</span><span class="stat-label">Failed</span></div>
                <div class="stat"><span class="stat-value" id="stat-cancelled">—</span><span class="stat-label">Cancelled</span></div>
                <div class="stat"><span class="stat-value" id="stat-expired">—</span><span class="stat-label">Expired</span></div>
                <div class="stat"><span class="stat-value" id="stat-24h">—</span><span class="stat-label">Last 24h</span></div>
            </div>
        </section>

        <!-- Search -->
        <section class="card" id="search-section">
            <h2>Search Offer</h2>
            <form id="search-form">
                <input type="text" id="search-input" placeholder="offer_xxxxxxxx">
                <button type="submit">Search</button>
            </form>
            <p id="search-error" class="error-text" hidden></p>
        </section>

        <!-- Badge Management -->
        <section class="card" id="badges-section">
            <h2>Badge Management</h2>

            <!-- Create Badge -->
            <div class="badge-subsection">
                <h3>Create Badge</h3>
                <form id="badge-create-form" class="badge-form">
                    <input type="text" id="badge-id-input" placeholder="badge_id (lowercase, underscores)" required pattern="^[a-z0-9_]+$">
                    <input type="text" id="badge-name-input" placeholder="Display Name" required maxlength="64">
                    <input type="text" id="badge-desc-input" placeholder="Description (optional)" maxlength="256">
                    <input type="text" id="badge-icon-input" placeholder="Icon emoji (default: ⭐)" maxlength="8">
                    <input type="text" id="badge-image-input" placeholder="Image URL (optional)">
                    <button type="submit">Create Badge</button>
                </form>
                <p id="badge-create-error" class="error-text" hidden></p>
                <p id="badge-create-success" class="success-text" hidden></p>
            </div>

            <!-- Award Badge -->
            <div class="badge-subsection">
                <h3>Award Badge</h3>
                <form id="badge-award-form" class="badge-form">
                    <select id="badge-award-select">
                        <option value="">Select a badge...</option>
                    </select>
                    <textarea id="badge-wallets-input" placeholder="Wallet addresses (one per line)" rows="4"></textarea>
                    <div class="badge-form-actions">
                        <button type="submit">Award</button>
                        <button type="button" id="badge-revoke-btn" class="btn-danger">Revoke</button>
                    </div>
                </form>
                <p id="badge-award-error" class="error-text" hidden></p>
                <p id="badge-award-success" class="success-text" hidden></p>
            </div>

            <!-- Badge List -->
            <div class="badge-subsection">
                <h3>Existing Badges</h3>
                <button id="badge-refresh-btn" class="btn-small">Refresh</button>
                <div id="badge-list" class="badge-list"></div>
                <p id="badge-list-empty" class="empty-text" hidden>No badges created yet.</p>
            </div>

            <!-- Backfill -->
            <div class="badge-subsection">
                <button id="badge-backfill-btn" class="btn-small">Backfill Swap Counts</button>
                <p id="badge-backfill-result" class="success-text" hidden></p>
            </div>
        </section>

        <!-- Offer Table -->
        <section class="card" id="offers-section">
            <h2>Recent Offers</h2>
            <div class="table-wrap">
                <table id="offers-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Offer ID</th>
                            <th>Status</th>
                            <th>Initiator</th>
                            <th>Receiver</th>
                            <th>Created</th>
                        </tr>
                    </thead>
                    <tbody id="offers-body"></tbody>
                </table>
            </div>
            <p id="offers-empty" class="empty-text" hidden>No offers found.</p>
        </section>
    </div>

    <script src="/admin/app.js"></script>
    <script>
        window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
