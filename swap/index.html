<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MidEvils NFT Swap - Create Trade Offer</title>
    <meta name="description" content="Midswap — peer-to-peer NFT trading with managed escrow for MidEvils collections.">
    <meta property="og:title" content="Midswap | MidEvils NFT Swap">
    <meta property="og:description" content="Midswap — peer-to-peer NFT trading with managed escrow for MidEvils collections.">
    <meta property="og:image" content="https://midhorde.com/orclogo.jpg">
    <meta property="og:url" content="https://midhorde.com/swap">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Midswap | MidEvils NFT Swap">
    <meta name="twitter:description" content="Midswap — peer-to-peer NFT trading with managed escrow for MidEvils collections.">
    <meta name="twitter:image" content="https://midhorde.com/orclogo.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/shared/base.css">
    <link rel="stylesheet" href="/shared/nav.css">
    <link rel="stylesheet" href="/swap/style.css">
    <link rel="icon" href="/orclogo.jpg" type="image/jpeg">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to content</a>
    <div class="background-overlay"></div>
    <nav class="site-nav">
        <a href="/">Home</a>
        <div class="nav-group">
            <span class="nav-group-label">Explore</span>
            <div class="nav-dropdown">
                <a href="/orc-viewer">Viewer</a>
                <a href="/holders">Leaderboard</a>
                <a href="/my-horde">My Horde</a>
                <a href="/create-orc">Create an Orc</a>
            </div>
        </div>
        <div class="nav-group">
            <span class="nav-group-label">Utility</span>
            <div class="nav-dropdown">
                <a href="/swap">MidSwap</a>
                <a href="/dao">DAO</a>
                <a href="/collage-maker">Collage Maker</a>
            </div>
        </div>
        <div class="nav-group">
            <span class="nav-group-label">Arcade</span>
            <div class="nav-dropdown">
                <a href="/minigame">Horde Tower Defense</a>
                <a href="/orc-run">Orc Run</a>
            </div>
        </div>
        <button id="nav-link-discord" class="nav-link-discord" title="Link Discord">Link Discord</button>
        <button id="nav-link-x" class="nav-link-x" title="Link X">Link X</button>
    </nav>
    <div class="container" id="main-content">
        <!-- Header -->
        <header class="swap-header">
            <h1>Midswap <span class="beta-tag">BETA</span></h1>
            <p>Trade MidEvils NFTs directly with other collectors</p>
            <nav class="swap-nav">
                <a href="/swap" class="nav-link active">Create Offer</a>
                <a href="/swap/offers.html" class="nav-link">My Offers</a>
            </nav>
        </header>

        <!-- How It Works -->
        <section class="how-it-works" id="howItWorks">
            <button class="how-it-works-toggle" id="howItWorksToggle">
                How does Midswap work? <span class="toggle-icon">+</span>
            </button>
            <div class="how-it-works-content" id="howItWorksContent" style="display: none;">
                <div class="how-it-works-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <div class="step-text">
                            <strong>Create an offer</strong>
                            <p>Select NFTs you want to trade and NFTs you want in return. Your offered NFTs are held in escrow until the trade completes.</p>
                        </div>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <div class="step-text">
                            <strong>Share with your trade partner</strong>
                            <p>Send them the offer link. They can review the trade and decide to accept or decline.</p>
                        </div>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <div class="step-text">
                            <strong>Trade completes automatically</strong>
                            <p>When accepted, NFTs are exchanged. If declined or cancelled, your NFTs are returned to you.</p>
                        </div>
                    </div>
                </div>
                <div class="trust-notice">
                    <strong>About Escrow:</strong> When you create an offer, your NFTs are transferred to a Midswap-managed escrow wallet until the trade completes or is cancelled. This is a managed service operated by MidHorde DAO, not a smart contract. Only trade amounts you're comfortable with.
                </div>
            </div>
        </section>

        <!-- Wallet Connection -->
        <section class="wallet-section">
            <div class="wallet-status" id="walletStatus">
                <span class="status-text">Not Connected</span>
            </div>
            <button id="connectWalletBtn" class="connect-btn">Connect Wallet</button>
            <button id="disconnectWalletBtn" class="disconnect-btn" style="display: none;">Disconnect</button>
        </section>

        <!-- Trade Partner Section -->
        <section class="trade-partner-section" id="tradePartnerSection" style="display: none;">
            <h2>Trade With</h2>
            <div class="input-row">
                <input type="text" id="partnerWalletInput" class="wallet-input" placeholder="Enter wallet address to trade with...">
                <button id="loadPartnerBtn" class="load-btn">Load NFTs</button>
            </div>
        </section>

        <!-- Loading State -->
        <div class="loading" id="loading" style="display: none;">Loading NFTs...</div>
        <div class="error" id="error" style="display: none;"></div>

        <!-- Trade Builder -->
        <section class="trade-builder" id="tradeBuilder" style="display: none;">
            <div class="trade-columns">
                <!-- Your Offer Side -->
                <div class="trade-column your-offer">
                    <div class="column-header">
                        <h3>You Give</h3>
                        <span class="selection-count" id="yourSelectionCount">0 selected</span>
                    </div>

                    <div class="sol-input-section">
                        <label for="yourSolAmount">+ Add SOL:</label>
                        <div class="sol-input-wrapper">
                            <input type="number" id="yourSolAmount" class="sol-input" min="0" step="0.01" value="0" placeholder="0.00">
                            <span class="sol-symbol">SOL</span>
                        </div>
                    </div>

                    <div class="nft-selection-area">
                        <p class="instruction">Select NFTs to offer (max 5)</p>
                        <div class="nft-grid" id="yourNFTGrid">
                            <div class="empty-state">Connect wallet to see your NFTs</div>
                        </div>
                    </div>
                </div>

                <!-- Arrow Divider -->
                <div class="trade-arrow" aria-hidden="true">
                    <span class="arrow-icon">&#8644;</span>
                </div>

                <!-- What You Want Side -->
                <div class="trade-column you-want">
                    <div class="column-header">
                        <h3>You Get</h3>
                        <span class="selection-count" id="theirSelectionCount">0 selected</span>
                    </div>

                    <div class="sol-input-section">
                        <label for="theirSolAmount">+ Request SOL:</label>
                        <div class="sol-input-wrapper">
                            <input type="number" id="theirSolAmount" class="sol-input" min="0" step="0.01" value="0" placeholder="0.00">
                            <span class="sol-symbol">SOL</span>
                        </div>
                    </div>

                    <div class="nft-selection-area">
                        <p class="instruction">Select NFTs you want (max 5)</p>
                        <div class="nft-grid" id="theirNFTGrid">
                            <div class="empty-state">Enter a wallet address above to see their NFTs</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trade Summary -->
        <section class="trade-summary" id="tradeSummary" style="display: none;">
            <h3>Trade Summary</h3>
            <div class="summary-content">
                <div class="summary-side giving">
                    <h4>You Give:</h4>
                    <div class="summary-items" id="summaryGiving">
                        <span class="placeholder">Nothing selected</span>
                    </div>
                </div>
                <div class="summary-arrow">&#10132;</div>
                <div class="summary-side receiving">
                    <h4>You Get:</h4>
                    <div class="summary-items" id="summaryReceiving">
                        <span class="placeholder">Nothing selected</span>
                    </div>
                </div>
            </div>
            <div class="fee-notice">
                <span class="fee-icon">&#9432;</span>
                <span>Platform fee: <strong>0.02 SOL</strong> (paid when offer is accepted) - <em>Free for Orc holders!</em></span>
            </div>
            <button id="createOfferBtn" class="create-offer-btn" disabled>Create Offer</button>
        </section>

        <!-- Success Modal -->
        <div class="modal" id="successModal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="successModalTitle">
            <div class="modal-content success-modal">
                <div class="modal-header">
                    <h2 id="successModalTitle">Offer Created!</h2>
                    <button class="close-modal-btn" id="closeSuccessModal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Your trade offer has been created successfully.</p>
                    <div class="offer-link-section">
                        <label>Share this link with the receiver:</label>
                        <div class="link-copy-row">
                            <input type="text" id="offerLinkInput" class="offer-link-input" readonly>
                            <button id="copyLinkBtn" class="copy-btn">Copy</button>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <a href="/swap/offers.html" class="view-offers-btn">View My Offers</a>
                        <button id="createAnotherBtn" class="create-another-btn">Create Another</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="swap-footer">
            <p>MidEvils NFT Swap &copy; 2024 | <a href="/">Back to The Horde</a></p>
        </footer>
    </div>

    <!-- Solana Web3.js for blockchain transactions -->
    <script src="/shared/nav.js"></script>
    <script defer src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js" integrity="sha384-xo1g+ODR6i1cxIVZeALc/apXFHeaJHO1j1whMO3dhtdBChWeaihnDs7UnXs9ch78" crossorigin="anonymous"></script>
    <!-- Extract Buffer from web3.js bundle for wallets that expect it globally (e.g. Solflare) -->
    <script defer src="/swap/buffer-polyfill.js"></script>
    <script defer src="/swap/constants.js"></script>
    <script defer src="/swap/ui-utils.js"></script>
    <script defer src="/swap/blockchain.js"></script>
    <script defer src="/swap/wallet.js"></script>
    <script defer src="/swap/nft-loading.js"></script>
    <script defer src="/swap/nft-display.js"></script>
    <script defer src="/swap/trade-builder.js"></script>
    <script defer src="/swap/offers-list.js"></script>
    <script defer src="/swap/offer-detail.js"></script>
    <script defer src="/swap/app.js"></script>
    <script defer src="/ambient-player.js"></script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
